{% extends "layout.twig" %}

{% block body %}
    <h1>Create a new Chatroom</h1>
    <form action="{{ path_for("create_room") }}" method="POST">
        <input type="hidden" name="csrf_name" value={{ csrf_name }}>
        <input type="hidden" name="csrf_value" value={{ csrf_value }}>
        
        <input type="text" name="name" placeholder="Chatroom name">
        <input type="password" name="password" placeholder="Password">
        <input type="password" name="password_confirm" placeholder="Confirm Password">
        
        <button type="submit">Create</button>
    </form>
    
    {# List of rooms the user owns #}
    <ul>
        {% for room in currentUser.rooms %}
            <li style="margin-bottom: 10px;">
                Name: {{room.name}}
                <br>
                Owner: {{room.owner.name}}
                <br>
                Private: {{room.private ? 'Yes' : 'No' }}
                <br>
                Members: {{room.members.count}}
                <br>
                
                <form action={{ path_for("room", { 'id': room.id }) }} method="GET" style="display: inline;">
                    <button type="submit">Open</button>
                </form>
                
                <form action={{ path_for("favourite_room", { 'id': room.id }) }} method="POST" style="display: inline;">
                    <input type="hidden" name="csrf_name" value={{ csrf_name }}>
                    <input type="hidden" name="csrf_value" value={{ csrf_value }}>
                    <input type="hidden" name="favourite" value={{ room.is_favourite ? "false" : "true" }}>
                    <button type="submit">{{ room.is_favourite ? "Unfavourite" : "Favourite" }}</button>
                </form>
                
                {% if currentUser == room.owner %}
                    <form action={{ path_for("delete_room", { 'id': room.id }) }} method="POST" style="display: inline;">
                        <input type="hidden" name="csrf_name" value={{ csrf_name }}>
                        <input type="hidden" name="csrf_value" value={{ csrf_value }}>
                        <button type="submit">Delete</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    
    {# Search #}
    <form action="{{ path_for("search_rooms") }}" method="GET">
        <input type="text" name="query" placeholder="Search">
        <button type="submit">Search</button>
    </form>
{% endblock %}